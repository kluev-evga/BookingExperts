{% extends "base.html" %}

{% block head %}
    <script>
        const exploreHotelRooms = (hotel_id) => {
            const dateFromSelectValue = document.getElementById("date-from").value;
            const dateToSelectValue = document.getElementById("date-to").value;
            window.location.href = `/hotels/${hotel_id}/rooms?date_from=${dateFromSelectValue}&date_to=${dateToSelectValue}`;
        }

        const onChangeDate = () => {
            fromElement = document.getElementById("date-from")

            selectedIndex = fromElement.selectedIndex
            document.querySelectorAll("#date-to option").forEach((item, i) => {
                i < selectedIndex ? item.setAttribute("disabled", null) : item.removeAttribute("disabled")
            })

            const dFrom = new Date(fromElement.value)
            const dTo = new Date(document.getElementById("date-to").value)
            if (dFrom > dTo) {
                dFrom.setDate(dFrom.getDate() + 1)
                const new_date = dFrom.toLocaleString('en-UK', {
                    year: "numeric",
                    month: "numeric",
                    day: "numeric",
                }).split('/').reverse().join('-')
                document.getElementById("date-to").value = new_date
            }
        }

        const searchHotels = (e) => {
            e.preventDefault()

            searchParams = new URLSearchParams()
            locationStr = document.getElementById("search").value
            locationStr && searchParams.append("location", locationStr)
            searchParams.append("date_from", document.getElementById("date-from").value)
            searchParams.append("date_to", document.getElementById("date-to").value)
            window.location.href = `/hotels/?${searchParams.toString()}`
        }

        document.addEventListener('DOMContentLoaded', () => {
            onChangeDate()
            document.forms.search.addEventListener("submit", searchHotels)
        })
    </script>
{% endblock %}

{% block content %}
    <form class="flex justify-center items-center mb-10" name="search">
        <div class="bg-slate-50 border-2 border-yellow-400 rounded-3xl w-1/4 text-lg px-3 py-1 mr-2">
            <input class="bg-slate-50 pr-10" id="search" type="text" value="{{ location }}" placeholder="найти ...">
        </div>
        <svg class="-ml-12 mr-8" height="21" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
            <path fill="#1d4ed8" d="M46.77 14.11c.52.05.96.16 1.31.25l.5.12c.46-.35.97-.98.96-1.51a3.68 3.68 0 0 1-1.88-1.45c-.6-.94-.7-1.83-.77-2.48-.05-.37-.08-.66-.2-.96a2 2 0 0 1-.03-1.33c.1-.27.2-.5.3-.73L43 7.27v5.8l.8.28c1.01.36 1.82.65 2.97.76zM2 11v6.16c.6 0 1.19-.04 1.92-.08l.8-.04c.43-.03.86-.17 1.34-.34a6.86 6.86 0 0 1 2.32-.48c.72 0 1.43.17 2.1.5 1.24.6 1.87 1.56 2.38 2.32.27.42.51.77.81 1.02.7.6 1.31.81 2.15 1.1.82.3 1.76.63 2.84 1.35.9.6 1.64 1.15 2.34 1.74V2.61L3.3 9.12A2 2 0 0 0 2 11zM20.09 43.1l-.17-.02v.18c-.03.7-.06 1.74-.78 2.67a3.97 3.97 0 0 1-3.26 1.66c-.72 0-1.4-.16-2-.31l-.35-.09c-1.23-.28-1.99-1-2.54-1.53a2.38 2.38 0 0 0-.66-.53 4.82 4.82 0 0 0-.86-.16c-.04 0-.12 0-.3.07-.45.18-.7.8-1.2 2.18-.14.43-.3.88-.48 1.33-.16.41-.2.94-.24 1.5-.07 1.11-.17 2.63-1.43 3.83A4.32 4.32 0 0 1 2 55.09V60a2 2 0 0 0 2.6 1.9L21 56.74V43.19a1.1 1.1 0 0 0-.34-.06l-.57-.04zM23.63 2.1c-.2-.07-.41-.1-.63-.1v24.15c.38.4.78.83 1.21 1.33.52.59.87 1.18 1.15 1.65.33.57.52.88.8 1.06.05.03.07.03.09.03.15 0 .45-.08.74-.17.53-.16 1.19-.36 1.96-.36.57 0 1.13.11 1.67.33l.35.15c1.57.64 3.52 1.44 4.36 4.2.53 1.7.53 3.14 0 4.78a4.41 4.41 0 0 1-1.65 2.24c-.12.09-.27.2-.3.25l-.02.05c-.02.08.03.34.07.57.13.64.31 1.6-.14 2.72-.76 1.85-2.26 2.8-4.45 2.8l-.7-.03a5.07 5.07 0 0 1-2.96-1.3 6.78 6.78 0 0 0-.71-.51 9.45 9.45 0 0 1-1.47-1.1V56.1l.6.19 17.4 5.5V23.2l-.55.02a33.1 33.1 0 0 1-2.16 0c-.46 0-.89.05-1.34.1-.49.06-1 .12-1.56.12-.7 0-1.37-.1-2.05-.28l-.72-.16c-1.02-.19-2.55-.48-3.65-2.28a7.12 7.12 0 0 1-.02-7.15c1.26-2.26 3.24-2.38 4.55-2.46.31-.02.6-.04.9-.08.37-.06.75-.08 1.11-.08 1.62 0 2.84.5 4.03.97.48.2.95.37 1.46.53V7.89l-.6-.2L23.63 2.1zM60.98 30.94l-.1-.03a6.18 6.18 0 0 1-3.9-2.18c-.88-1-1.07-2.19-1.2-3.05-.05-.3-.13-.75-.2-.89-.15.01-.43.1-.68.16-.5.14-1.14.31-1.87.34-.62.03-1.18.18-1.78.34-.73.2-1.55.42-2.5.42-.7 0-1.35-.11-2.03-.34-1.05-.36-1.74-.95-2.3-1.41a3.91 3.91 0 0 0-1-.7l-.42-.15v38.33l17.63-5.88A2 2 0 0 0 62 54V31.1l-1.02-.16z"/>
            <g fill="#0f172a">
                <path d="M62.36.77A4 4 0 0 0 58.8.2l-17.77 5.6L24.26.21a3.99 3.99 0 0 0-2.64.04l-19 7A4 4 0 0 0 0 11v49a4 4 0 0 0 5.2 3.81L23 58.2l17.8 5.62a3.98 3.98 0 0 0 2.47-.02l18-6A4 4 0 0 0 64 54V4A4 4 0 0 0 62.36.77zM21 56.73 4.6 61.9A2 2 0 0 1 2 60v-4.9c.23.02.47.05.72.05 1.19 0 2.2-.41 3.1-1.27 1.26-1.2 1.36-2.72 1.43-3.83.04-.56.08-1.09.24-1.5.18-.45.34-.9.49-1.33.48-1.37.74-2 1.19-2.18.18-.07.26-.07.3-.07.18 0 .5.07.86.16.15.04.4.28.66.53.55.53 1.31 1.25 2.54 1.53l.36.09c.6.15 1.27.31 1.99.31 1.32 0 2.44-.57 3.27-1.66.7-.93.74-1.98.76-2.67l.01-.18.17.01.57.04c.12 0 .23.02.34.06v13.54zm0-15.56c-.1-.01-.18-.04-.28-.04-.37-.02-.71-.06-1.02-.06-.49 0-.93.1-1.36.58-.75.8-.1 2.18-.8 3.07-.49.67-1.05.87-1.66.87-.59 0-1.23-.19-1.9-.35-1.37-.31-1.82-1.73-3.18-2.06-.51-.12-.92-.21-1.33-.21-.33 0-.66.06-1.05.22-1.7.68-1.97 2.58-2.79 4.63-.67 1.69 0 3.48-1.19 4.61-.57.55-1.12.72-1.72.72-.23 0-.47-.03-.72-.06V19.15c.88 0 1.72-.06 2.84-.12 1.4-.08 2.4-.81 3.54-.81.38 0 .78.08 1.22.3 1.34.65 1.59 2.07 2.79 3.08 1.8 1.51 3.24 1.29 5.16 2.57 1.43.96 2.42 1.76 3.45 2.79v14.2zm0-16.92c-.7-.59-1.44-1.14-2.34-1.74-1.08-.72-2.02-1.05-2.84-1.35-.84-.29-1.44-.5-2.15-1.1-.3-.25-.54-.6-.81-1.02-.5-.76-1.14-1.71-2.39-2.32a4.67 4.67 0 0 0-2.1-.5c-.9 0-1.65.25-2.3.48-.5.17-.92.31-1.34.33l-.8.05c-.74.04-1.33.07-1.93.08V11a2 2 0 0 1 1.3-1.88L21 2.61v21.64zm2 4.91c.75 1.01 1.04 2.04 2.08 2.71.4.26.79.36 1.17.36.9 0 1.75-.53 2.7-.53.3 0 .59.05.9.17 1.6.67 2.96 1.08 3.57 3.1.4 1.3.41 2.3 0 3.59-.4 1.3-1.6 1.23-1.98 2.57-.33 1.14.43 2.02 0 3.09-.53 1.29-1.5 1.56-2.6 1.56l-.58-.02c-1.17-.07-1.7-.91-2.78-1.54-1.02-.6-1.72-1.43-2.48-2.08V29.16zm18-7.95c-.54.01-1.1.04-1.73.04a15.46 15.46 0 0 1-.98-.02c-1.1 0-1.95.22-2.9.22-.47 0-.96-.06-1.52-.2-1.29-.37-2.36-.2-3.18-1.54a5.13 5.13 0 0 1 0-5.15c.95-1.7 2.37-1.3 3.98-1.54.3-.04.57-.06.84-.06 2 0 3.31 1.03 5.49 1.6v6.65zm0-8.75c-.5-.16-.98-.34-1.46-.53a10.2 10.2 0 0 0-4.03-.97c-.36 0-.74.02-1.11.08-.3.04-.59.06-.9.08-1.3.07-3.28.2-4.55 2.46a7.12 7.12 0 0 0 .03 7.15c1.1 1.8 2.63 2.1 3.64 2.28.26.05.5.1.72.16a7.6 7.6 0 0 0 2.05.28c.57 0 1.07-.06 1.56-.12.45-.05.88-.1 1.34-.1a16.12 16.12 0 0 0 .98.02l1.18-.02.55-.02v38.57l-17.4-5.5-.6-.18V44.85c.42.37.9.75 1.47 1.1.24.13.47.31.71.5a5.07 5.07 0 0 0 3.66 1.33c2.19 0 3.69-.94 4.45-2.8.45-1.12.27-2.08.14-2.71-.04-.23-.1-.5-.07-.58l.02-.05c.03-.04.18-.16.3-.25a4.4 4.4 0 0 0 1.65-2.24 7.42 7.42 0 0 0 0-4.77c-.84-2.77-2.8-3.57-4.36-4.21l-.35-.14a4.38 4.38 0 0 0-1.67-.33c-.77 0-1.43.2-1.96.35-.29.09-.59.18-.74.18l-.08-.04c-.29-.18-.48-.49-.81-1.06a10.2 10.2 0 0 0-1.15-1.65c-.43-.5-.83-.93-1.21-1.33V2c.22 0 .43.03.63.1L40.4 7.7l.6.2v4.56zm2-5.19 3.96-1.25c-.1.23-.2.46-.3.73a2 2 0 0 0 .04 1.33c.1.3.14.59.19.96.07.65.18 1.54.77 2.48.6.92 1.4 1.27 1.87 1.45.02.53-.5 1.16-.94 1.5a6.1 6.1 0 0 1-.5-.1 8.7 8.7 0 0 0-1.32-.26c-1.15-.11-1.96-.4-2.98-.76l-.8-.28v-5.8zM62 54a2 2 0 0 1-1.37 1.9L43 61.77V23.45l.42.15c.35.15.63.38 1 .7.56.46 1.25 1.05 2.3 1.4.68.24 1.34.35 2.02.35.96 0 1.78-.22 2.51-.42.6-.16 1.16-.31 1.78-.34.73-.03 1.36-.2 1.87-.34.25-.07.53-.15.68-.16.08.14.15.6.2.9.14.85.32 2.03 1.2 3.03a6.17 6.17 0 0 0 3.9 2.2l.1.01c.33.07.67.12 1.02.16V54zm0-24.91-.73-.14a4.21 4.21 0 0 1-2.78-1.54c-1.04-1.19-.44-3.11-1.58-4.12a1.9 1.9 0 0 0-1.3-.5c-.82 0-1.66.47-2.67.5-1.67.08-2.81.76-4.2.76-.42 0-.87-.06-1.37-.23-1.34-.46-1.85-1.51-3.18-2.06-.42-.18-.81-.3-1.19-.38V15.2c1.13.4 2.13.77 3.58.91.79.08 1.43.38 2.07.38.36 0 .72-.1 1.1-.38 1.2-.9 2.23-2.52 1.6-4.1-.42-1.05-1.41-.66-2-1.55-.62-.98-.33-1.88-.78-3.08.28-.87.76-1.5 1.03-2.18l9.8-3.1a1.99 1.99 0 0 1 1.78.3c.51.37.82.98.82 1.61v25.09z"/>
                <path d="M55.3 39.32c-.67-.2-1.31-.4-2-.4-.66 0-1.24.17-1.8.54-.64.42-.82.93-.86 1.29-.12.96.6 1.72 1.36 2.52.5.54 1.27 1.35 1.12 1.74-.1.25-.39.4-.98.63-.74.3-1.85.74-2.1 2.07-.13.74.04 1.42.5 1.96.63.76 1.78 1.18 3.24 1.18 1.5 0 2.96-.43 3.93-1.15 1.65-1.27 2.29-3.12 1.89-5.5a5.85 5.85 0 0 0-4.3-4.88zm1.2 8.78c-.6.46-1.67.75-2.72.75-.91 0-1.52-.23-1.71-.46-.04-.04-.1-.11-.06-.32.04-.2.2-.3.87-.57.72-.29 1.7-.68 2.1-1.78.6-1.56-.63-2.86-1.53-3.82-.24-.25-.57-.6-.73-.84.52-.28 1.12-.1 2.05.2a3.84 3.84 0 0 1 2.85 3.26c.29 1.67-.06 2.78-1.11 3.58z"/>
            </g>
            <path fill="#f59e0b" d="M61.18 2.39a2.01 2.01 0 0 0-1.78-.3l-9.8 3.1c-.27.69-.75 1.3-1.04 2.18.46 1.2.16 2.1.79 3.08.58.9 1.58.5 2 1.54.63 1.6-.4 3.22-1.6 4.11a1.8 1.8 0 0 1-1.1.38c-.65 0-1.28-.3-2.08-.38-1.44-.14-2.44-.5-3.57-.91v6.2c.38.07.77.18 1.2.36 1.31.55 1.83 1.6 3.17 2.07.5.16.95.23 1.37.23 1.39 0 2.53-.68 4.2-.76 1.01-.03 1.85-.5 2.67-.5.43 0 .85.12 1.3.5 1.14 1 .54 2.93 1.58 4.12a4.22 4.22 0 0 0 2.78 1.54l.73.14V4a2 2 0 0 0-.82-1.61zM34.67 13.02c-1.6.23-3.03-.15-3.98 1.54a5.13 5.13 0 0 0 0 5.15c.82 1.34 1.9 1.17 3.18 1.53.56.16 1.05.2 1.52.2.95 0 1.8-.2 2.9-.2h.35l.63.01c.63 0 1.19-.02 1.73-.04v-6.66c-2.17-.56-3.49-1.6-5.49-1.6-.27 0-.54.03-.84.07zM29.85 31.87a2.35 2.35 0 0 0-.9-.17c-.95 0-1.8.53-2.7.53-.38 0-.76-.1-1.17-.36-1.04-.67-1.33-1.7-2.08-2.7v12.97c.76.65 1.46 1.48 2.48 2.08 1.08.63 1.6 1.47 2.78 1.54l.58.02c1.1 0 2.07-.27 2.6-1.56.43-1.08-.33-1.95 0-3.1.38-1.33 1.57-1.26 1.98-2.56a5.4 5.4 0 0 0 0-3.6c-.61-2.01-1.97-2.42-3.57-3.09zM12.38 21.6c-1.2-1-1.44-2.43-2.78-3.08-.44-.22-.84-.3-1.22-.3-1.15 0-2.15.74-3.54.81-1.12.06-1.96.12-2.84.13v33.93c.25.03.49.06.72.06.6 0 1.14-.17 1.72-.72 1.18-1.12.52-2.92 1.19-4.61.82-2.04 1.1-3.95 2.78-4.63.4-.16.73-.22 1.06-.22.41 0 .82.1 1.33.22 1.35.33 1.8 1.74 3.17 2.05.68.16 1.32.35 1.91.35.61 0 1.17-.2 1.67-.86.68-.9.03-2.27.79-3.08.43-.48.87-.58 1.35-.58.32 0 .66.05 1.03.06.1 0 .18.03.28.04V26.96a21.85 21.85 0 0 0-3.45-2.79c-1.92-1.28-3.36-1.06-5.17-2.57zM54.77 41.25c-.93-.29-1.53-.47-2.05-.19.16.24.5.6.73.84.9.96 2.13 2.26 1.54 3.82-.41 1.1-1.4 1.5-2.1 1.78-.69.27-.84.37-.88.57-.03.2.02.28.06.32.2.23.8.46 1.72.46 1.04 0 2.1-.3 2.72-.75 1.05-.8 1.4-1.91 1.11-3.58a3.84 3.84 0 0 0-2.85-3.27z"/>
            <path fill="#231F20" d="M41 61.78 23 56V2l18 6z" opacity=".2"/>
        </svg>
        <span>С</span>
        <select id="date-from" class="bg-slate-400 p-2 mx-2" onchange="onChangeDate()">
            {% for date in dates_from %}
                <option value="{{ date }}" {{ 'selected' if date == date_from }}>
                    {{ date }}
                </option>
            {% endfor %}
        </select>
        <span>По</span>
        <select id="date-to" class="bg-slate-400 p-2 mx-2">
            {% for date in dates_to %}
                <option value="{{ date }}" {{ 'selected' if date == date_to }}>
                    {{ date }}
                </option>
            {% endfor %}
        </select>
        <button class="text-xl bg-yellow-400 px-3 py-1.5 rounded-sm" type="submit">
            Найти
        </button>
    </form>

    {% if hotels %}
        <div class="flex flex-col">
            {% for hotel in hotels %}
            <div class="flex shadow-md mb-5 pr-4 items-center">
                <img width="300" src="{{ url_for('static', path='images/' + hotel.image_id|string + '.webp') }}" alt="Отель">
                <div class="px-4 py-3 grow">
                    <div class="pl-1 font-bold">{{ hotel.name }}</div>
                    <hr class="my-2">
                    <div class="mb-2 pl-1 max-w-xs">{{ hotel.description }}</div>
                    <div class="mb-2">
                        <svg class="inline text-slate-700 -mt-1" xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24">
                            <path fill="CurrentColor" fill-rule="evenodd" clip-rule="evenodd" d="M3.5 20.5C4.9 22 7.3 22 12 22s7 0 8.5-1.5C22 19.1 22 16.7 22 12s0-7-1.5-8.5C19.1 2 16.7 2 12 2S5 2 3.5 3.5C2 4.9 2 7.3 2 12s0 7 1.5 8.5ZM16.9 8.2l-3.5 9.2c-.3.8-1.5.8-1.7 0l-1-3.5c-.1-.2-.4-.5-.6-.5l-3.5-1c-.8-.3-.8-1.5 0-1.8L15.8 7a.9.9 0 0 1 1.1 1.1Z"/>
                        </svg>
                        {{ hotel.location }}
                    </div>
                    <div class="mb-2 pl-1">{{ " · ".join(hotel.services) }}</div>
                    <div class="pl-1">Осталось номеров: {{ hotel.rooms_left }} из {{hotel.rooms_quantity}}</div>
                </div>
                <div class="flex justify-top flex-col items-center py-3">
                    <div>
                        от <span class="font-bold text-3xl">25 999</span>
                    </div>
                    <span class="mb-5">за ночь</span>
                    <button onclick="exploreHotelRooms('{{ hotel.id }}')" class="text-lg bg-yellow-400 px-4 py-1.5 rounded-sm" type="button">
                        Выбрать номер
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    {% endif %}
{% endblock %}